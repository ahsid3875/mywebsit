<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ§­ My Flowchart Generator</title>

  <!-- âœ… Mermaid v11 Stable -->
  <script type="module">
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs";

    // Initialize Mermaid once
    mermaid.initialize({ startOnLoad: false, theme: "default" });

    window.renderMermaid = () => {
      const textarea = document.getElementById("mermaidInput");
      const output = document.getElementById("mermaidOutput");

      // âœ… Clean code: convert tabs to spaces, normalize line endings
      let code = textarea.value
        .replace(/\t/g, "    ")
        .replace(/\r/g, "")
        .trim();

      // âœ… Ensure each connection has a newline (to prevent line merging)
      code = code.replace(/](?=\s*[A-Za-z(])/g, "]\n");

      // âœ… Add flowchart header if missing
      if (!/^flowchart\s+/i.test(code)) {
        code = "flowchart TD\n" + code;
      }

      // âœ… Inject diagram
      output.innerHTML = `<div class="mermaid">${code}</div>`;

      // âœ… Try rendering
      mermaid.run({ nodes: output.querySelectorAll(".mermaid") }).catch(err => {
        output.innerHTML = `<p style="color:red;">âŒ Error: ${err.message}</p>`;
      });
    };

    // Auto-render default diagr
